<!DOCTYPE html>
<html>
    <head>
        <title>FalconBet</title>
        <script src="https://cdn.jsdelivr.net/npm/faunadb@latest/dist/faunadb.js"></script>
    </head>
    <body onload="getBets()">
<h1>When will the queen die?</h1>
<h2>Place your bets now!</h2>
<label>Username</label>
<input id="username" style="margin-left: 10px;" placeholder="Enter a name..." type="text"><br><br>
<label>Amount (£)</label>
<input id="money" style="margin-left: 10px;" placeholder="Enter an amount..." type="number"><br><br>
<label>Date</label>
<input id="date" style="margin-left: 10px;" placeholder="Enter a date..." type="date"><br><br>
<button onclick="placeBet()" style="cursor: pointer; width: 200px; height: 25px;">Place Bet!</button><br><br>
<label id="bets"></label>
<script>
    var faunadb = window.faunadb
  var q = faunadb.query
  var client = new faunadb.Client({
    secret: 'fnAEcG0iEaAAyB4b6yraRVIIsvt7lFIxvPDfiD6y',
    domain: 'db.eu.fauna.com',
    scheme: 'https',
  })
    function placeBet(){
        if(document.getElementById("username").value == "" || document.getElementById("date").value == "" || document.getElementById("money").value == ""){
            alert("Please fill in all fields before placing a bet.")
        }
        else{
        client.query(
  q.Create(
    q.Collection('falconbet'),
    { data: { name: document.getElementById("username").value, date:  document.getElementById("date").value, money:  document.getElementById("money").value } },
  )
)
.then(function (ret){

console.log(ret)

})
        }


    }


    function getBets(){
        client.query(
   q.Map(
  q.Paginate(q.Documents(q.Collection('falconbet'))),
  q.Lambda(x => q.Get(x))
)).then (function(x){ 
    let bets = ""
    var total = 0
    for (var i = x.data.length - 1; i >= 0; i--) {
      total = total + x.data[i].data.money
      bets = bets + x.data[i].data.name + " bets £" + x.data[i].data.money + " that the queen will die on " + x.data[i].data.date + "<br>"

    }    
    console.log("Total betted: " + total)
    document.getElementById("bets").innerHTML = bets    
    })
    }
</script>
    </body>
</html>
