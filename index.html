<!DOCTYPE html>
<html>
    <head>
        <title>FalconBet</title>
        <script src="https://cdn.jsdelivr.net/npm/faunadb@latest/dist/faunadb.js"></script>
    </head>
    <body onload="getBets()">
<h1>When will the queen die?</h1>
<h2 id="title">Place your bets now and you could win £0!</h2>
<label>Username</label>
<input id="username" style="margin-left: 10px;" placeholder="Enter a name..." type="text"><br><br>
<label>Amount (£)</label>
<input id="money" style="margin-left: 10px;" placeholder="Enter an amount..." type="number"><br><br>
<label>Date</label>
<input id="date" style="margin-left: 10px;" placeholder="Enter a date..." type="date"><br><br>
<label id="question">(Anti-Spam) Type AAAAAA in the box to verify.</label>
<input id="response" style="margin-left: 10px;" placeholder="Enter a date..." type="text"><br><br>
<button onclick="placeBet()" style="cursor: pointer; width: 200px; height: 25px;">Place Bet!</button><br><br>
<h2>Recent Bets</h2>
<label id="bets"></label>
<script>
    var faunadb = window.faunadb
  var q = faunadb.query
  var client = new faunadb.Client({
    secret: 'fnAEcG0iEaAAyB4b6yraRVIIsvt7lFIxvPDfiD6y',
    domain: 'db.eu.fauna.com',
    scheme: 'https',
  })
  let captcha = ""
    function placeBet(){
      if(document.getElementById("response").value != captcha)
      {
        alert("Anti-Spam question failed!")
      }
      else
      {
        if(document.getElementById("username").value == "" || document.getElementById("date").value == "" || document.getElementById("money").value == ""){
            alert("Please fill in all fields before placing a bet.")
        }
        else{
            if(parseInt(document.getElementById("money").value) > 10000)
            {
              alert("Please bet less than £10000.")
            }
            else
            {
        client.query(
  q.Create(
    q.Collection('falconbet2'),
    { data: { name: document.getElementById("username").value, date:  document.getElementById("date").value, money:  document.getElementById("money").value } },
  )
)
.then(function (ret){

getBets()

})
        }}
      }    


    }

    function makeid(length) {
    var result           = '';
    var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    var charactersLength = characters.length;
    for ( var i = 0; i < length; i++ ) {
      result += characters.charAt(Math.floor(Math.random() * 
 charactersLength));
   }
   return result;
}


    function getBets(){
      captcha = makeid(6)
      document.getElementById("question").innerHTML = "(Anti-Spam) Type " + captcha + " to verify."
        client.query(
   q.Map(
  q.Paginate(q.Documents(q.Collection('falconbet2'))),
  q.Lambda(x => q.Get(x))
)).then (function(x){ 
    let bets = ""
    var total = 0
    if(x.data.length < 10)
    {
    for (var i = x.data.length - 1; i >= 0; i--) {
      bets = bets + "&bull; " + x.data[i].data.name + " bets £" + x.data[i].data.money + " that the queen will die on " + x.data[i].data.date + "<br>"

    }    
  }
  else{
    for (var i = 10 - 1; i >= 0; i--) {
      bets = bets + "&bull; " + x.data[i].data.name + " bets £" + x.data[i].data.money + " that the queen will die on " + x.data[i].data.date + "<br>"

    }   
  }
  for (var i = x.data.length - 1; i >= 0; i--) {
      total = total + parseInt(x.data[i].data.money)
  }
    document.getElementById("title").innerHTML = "Place your bets now and you could win £" + total + "!"
    document.getElementById("bets").innerHTML = bets    
    })
    }
</script>
    </body>
</html>
